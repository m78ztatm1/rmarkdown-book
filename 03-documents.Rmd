---
title: "第一次作业"
date: "2024-11-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```
##第一章

# I R软件与金融数据

## 1.1 本课程的软件需求
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(quantmod)
library(lubridate)
library(tidyverse)
```


## 1.2 基本R使用

### 1.2.1 四则运算

```{r}
# 四则运算示例
1 + 1
2 - 1
3 * 2
4 / 2
5 ^ 2
```

### 1.2.2 字符串

```{r}
# 字符串示例
"Hello, World!"
```

### 1.2.3 向量

```{r}
# 向量示例
x <- c(1, 2, 3, 4, 5)
x
```

### 1.2.4 矩阵

```{r}
# 矩阵示例
m <- matrix(1:9, nrow = 3)
m
```

### 1.2.5 数据框

```{r}
# 数据框示例
df <- data.frame(
  Name = c("Alice", "Bob", "Charlie"),
  Age = c(25, 30, 35)
)
df
```

### 1.2.6 扩展包

```{r}
# 扩展包示例
# 已在setup中加载quantmod, lubridate, tidyverse
```

### 1.2.7 日期和日期时间

```{r}
# 日期和日期时间示例
date1 <- as.Date("2024-01-01")
date1
```

### 1.2.8 读入时间序列数据

#### 1.2.8.1 单个向量读入

```{r}
# 单个向量读入示例
x <- scan(text = "1 2 3 4 5")
x
```

#### 1.2.8.2 带有时间标签的序列

```{r}
# 带有时间标签的序列读入示例
d <- data.frame(
  date = seq(as.Date("2001-01-01"), by = "month", length.out = 12),
  value = rnorm(12)
)
d
```

#### 1.2.8.3 读入csv格式

```{r}
# 读入csv格式示例
d <- read.csv(text = "date,value
2001-01-01,1
2001-02-01,2
2001-03-01,3
2001-04-01,4
2001-05-01,5", header = TRUE)
d
```

## 1.3 生成时间序列数据

### 1.3.1 生成ts类型

```{r}
# 生成ts类型示例
ts_data <- ts(rnorm(12), start = c(2001, 1), frequency = 12)
ts_data
```

### 1.3.2 生成xts类型

```{r}
# 生成xts类型示例
library(xts)
xts_data <- xts(rnorm(12), order.by = seq(as.Date("2001-01-01"), by = "month", length.out = 12))
xts_data
```

## 1.4 ts类型

### 1.4.1 ts类型介绍

```{r}
# ts类型介绍示例
ts_data <- ts(c(4, 8, 7, 7, 3, 1, 8, 9, 8, 6, 3, 5), frequency = 1, start = 2001)
ts_data
```

### 1.4.2 ts类型属性

```{r}
# ts类型属性示例
start(ts_data)
end(ts_data)
frequency(ts_data)
```

## 1.5 zoo类型

### 1.5.1 zoo类型介绍

```{r}
# zoo类型介绍示例
library(zoo)
zoo_data <- zoo(c(4, 8, 7, 7, 3, 1, 8, 9, 8, 6, 3, 5), order.by = seq(as.Date("2001-01-01"), by = "month", length.out = 12))
zoo_data
```

## 1.6 xts类型

### 1.6.1 xts类型介绍

```{r}
# xts类型介绍示例
xts_data <- xts(c(4, 8, 7, 7, 3, 1, 8, 9, 8, 6, 3, 5), order.by = seq(as.Date("2001-01-01"), by = "month", length.out = 12))
xts_data
```

### 1.6.2 xts类型属性

```{r}
# xts类型属性示例
index(xts_data)
```

## 1.7 tsibble类型

### 1.7.1 tsibble类型介绍

```{r}
# tsibble类型介绍示例
library(tsibble)
tsibble_data <- as_tsibble(data.frame(date = seq(as.Date("2001-01-01"), by = "month", length.out = 12), value = rnorm(12)), index = "date")
tsibble_data
```

## 1.8 quantmod包的功能

### 1.8.1 quantmod包数据下载

```{r}
# quantmod包数据下载示例
MSFT <- getSymbols("MSFT", src = "yahoo", auto.assign = FALSE)
head(MSFT)
```

### 1.8.2 quantmod包图形功能

```{r}
# quantmod包图形功能示例
chartSeries(MSFT, theme = "white", name = "Microsoft")
```

## 1.9 用BatchGetSymbols包下载金融数据

```{r}
# BatchGetSymbols包下载金融数据示例
library(BatchGetSymbols)
tickers <- c("MSFT", "AAPL", "GOOG")
dates <- Sys.Date() - 365 + 1 : 0
BatchGetSymbols(tickers, from = dates[1], to = dates[2], src = "yahoo")
```

## 1.10 tseries包的功能

### 1.10.1 tseries包数据下载

```{r}
# tseries包数据下载示例
library(tseries)
get.hist.quote("^GSPC", src = "yahoo", auto.assign = TRUE)
head(GSPC)
```

## 1.11 R软件的其他时间序列类型和功能

### 1.11.1 声音数据分析

```{r}
# 声音数据分析示例
library(seewave)
song <- loadSample("song.wav")
oscillo(song, f = rate(song), title = "Sound Wave")
```



##第二章
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(quantmod)
library(xts)
library(zoo)
library(TTR)
```

```{r library加载}
# 加载必要的库
library(quantmod)
library(xts)
library(zoo)
library(TTR)
```

```{r 数据读取}
# 读取数据
AAPL <- getSymbols("AAPL", src="yahoo", auto.assign=FALSE)
```

```{r 对数收益率计算}
# 计算对数收益率
logret.AAPL <- diff(log(AAPL$AAPL.Adjusted))*100
```

```{r 时间序列曲线图}
# 绘制对数收益率时间序列曲线图
chartSeries(logret.AAPL, type="l", TA=NULL, subset="2007/2017", name="Apple Log Returns", theme="white", major.ticks="years", minor.ticks=FALSE)
```

```{r 直方图}
# 绘制对数收益率的直方图
x <- coredata(logret.AAPL)
hist(x, main="Apple Log Returns", xlab="", ylab="")
```

```{r 核密度估计}
# 核密度估计图并叠加正态密度估计
tmp.1 <- density(x, na.rm=TRUE)
tmp.x <- seq(min(x, na.rm=TRUE), max(x, na.rm=TRUE), length.out=100)
tmp.y <- dnorm(tmp.x, mean(x, na.rm=TRUE), sd(x, na.rm=TRUE))
tmp.ra <- range(c(tmp.1$y, tmp.y), na.rm=TRUE)
plot(tmp.1, main="Apple Log Return", ylim=tmp.ra)
lines(tmp.x, tmp.y, lwd=2, col="red")
legend("topleft", lwd=c(1,2), col=c("black", "red"), legend=c("Kernel density Est.", "Parametric normal density est."))
```

```
install.packages(c("xts", "zoo", "TTR"))
install.packages("TTR")
install.packages("tmodquantmod")
#1
# 安装并加载zoo包
library(zoo)

# 设置随机种子以获得可重复的结果
set.seed(1)

# 创建一个包含12个随机数的时间序列
z.1 <- zoo(sample(3:6, size=12, replace=TRUE),
           seq.Date(from=as.Date("2018-01-01"), by="day", length.out=12))

# 绘制时间序列z.1
plot(z.1)
```

```
#2
# 安装并加载quantmod包
library(quantmod)

# 设置随机种子以获得可重复的结果
set.seed(1)

# 从雅虎金融下载微软公司的股票日数据
MSFT <- getSymbols("MSFT", src="yahoo", auto.assign = FALSE)
# 查看数据的前几行
head(MSFT)

# 查看数据结构
str(MSFT)

# 从雅虎金融获取美国10年债日数据
TNX <- getSymbols("^TNX", auto.assign = FALSE)
# 查看数据的前几行
head(TNX)

# 从FRED下载日元对美元汇率日数据
DEXJPUS <- getSymbols("DEXJPUS", src="FRED", auto.assign=FALSE)
# 查看数据的最后几行
tail(DEXJPUS)

# 从FRED下载美国失业率月度数据
UNRATE <- getSymbols("UNRATE", src="FRED", auto.assign=FALSE)

# 从Oanda下载铂金数据（注意：Oanda可能需要API密钥）
# XPTUSD <- getSymbols("XPT/USD", src="oanda", auto.assign=FALSE) # 这可能需要额外的设置

# 绘制微软公司股票的收盘价图表
chartSeries(MSFT[, "MSFT.Close"], name="Microsoft Stock Price")
chartSeries(MSFT, theme="white", name="Microsoft", subset="2017-12-01/2017-12-31")
```

```
#3
F <- 100
P <- 95

# 绘制标准收益率曲线
curve(((F - P) / F * 360 / x * 100), from = 28, to = 364, col = "red",
      xlab = "Days", ylab = "Yield to Maturity (YTM)")

# 绘制精确收益率曲线
curve(((F / P) ^ (365.25 / x) - 1) * 100, from = 28, to = 364,
      add = TRUE, lty = 2, col = "green")

# 添加图例
legend("topright", lty = c(1, 2), col = c("red", "green"),
       legend = c("Standard", "Exact"))
```

```
#4
library(TTR)
load("/Users/gxy/Desktop/时间序列/ftsdata/AAPL.RData")
#调用数据的时候一定要注意，r语言中的文件路径是/间隔的，需要手动修改
install.packages("quantmod")
library(quantmod)
# 首先确保已经安装并加载了quantmod包
# 绘制图表
chartSeries(AAPL,
            type = "line",
            TA = NULL,
            subset = "2003/2017",
            major.ticks = "years",
            minor.ticks = FALSE,
            theme = "white",
            name = "Apple")
```

```
#5
TNX <- getSymbols("^TNX", src="yahoo", auto.assign=FALSE) 
logret.TNX <- diff(log(TNX$TNX.Adjusted))*100 # 对数收益率
chartSeries(
  logret.TNX, type="l", TA=NULL,
  subset="2007/2017",
  name="US 10 Years T Notes Log Return",
  theme="white", major.ticks="years", minor.ticks=FALSE)
x <- coredata(logret.TNX)
hist(x, main="US 10 Year T Notes Log Returns", xlab="", ylab="")
x <- coredata(logret.TNX)
qqnorm(x, main="US 10 Year T Notes Log Returns") qqline(x, col="red")
```


##第三章

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(quantmod)
library(lubridate)
library(tidyverse)
library(forecast)
```

# 第三章 线性时间序列模型

## 3.1 介绍

### 3.1.1 例子：苹果公司股票日收盘价

```{r}
AAPL <- getSymbols("AAPL", src="yahoo", auto.assign=FALSE)
chartSeries(AAPL, type="line", subset="2003/2017", major.ticks="years", minor.ticks=FALSE, theme="white", name="Apple")
```

### 3.1.2 例子：可口可乐公司盈利季度数据

```{r}
da <- read_table("q-ko-earns8309.txt", col_types=cols(.default=col_double(), ends=col_date("%Y%m%d"), anntime=col_date("%Y%m%d")))
ko.Rqtr <- xts(da[["value"]], da[["ends"]])
chartSeries(ko.Rqtr, type="line", major.ticks="years", minor.ticks=FALSE, theme="white", name="Coca Cola Quarterly Return")
```

## 3.2 平稳性

### 3.2.1 随机游动

```{r}
# 随机游动示例
set.seed(123)
rw <- cumsum(rnorm(100))
plot(rw, type="l", main="Random Walk")
```

### 3.2.2 带漂移的随机游动

```{r}
# 带漂移的随机游动示例
rw_drift <- cumsum(rnorm(100)) + 0.03 * (1:100)
plot(rw_drift, type="l", main="Random Walk with Drift")
```

## 3.3 相关系数和自相关函数

### 3.3.1 自相关函数与白噪声

```{r}
# 自相关函数与白噪声示例
library(TTR)
data("FTSE")
acf(FTSE, main="ACF of FTSE")
pacf(FTSE, main="PACF of FTSE")
```

## 3.4 线性时间序列

### 3.4.1 AR模型

```{r}
# AR模型示例
ar_data <- arima.sim(n = 100, model = list(ar = 0.5), sd = 1)
plot(ar_data, type="l", main="AR(1) Model")
```

### 3.4.2 MA模型

```{r}
# MA模型示例
ma_data <- arima.sim(n = 100, model = list(ma = 0.5), sd = 1)
plot(ma_data, type="l", main="MA(1) Model")
```

### 3.4.3 ARMA模型

```{r}
# ARMA模型示例
arma_data <- arima.sim(n = 100, model = list(ar = 0.5, ma = 0.3), sd = 1)
plot(arma_data, type="l", main="ARMA(1,1) Model")
```


